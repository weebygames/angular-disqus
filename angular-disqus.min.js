/* 
 * angular-disqus 1.1.0
 * http://github.com/kirstein/angular-disqus
 * 
 * Licensed under the MIT license
 */
!function(a,b){"use strict";var c=a.module("ngDisqus",[]);c.provider("$disqus",function(){function c(){return document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]}function d(){return m||b.disqus_shortname}function e(a){m=a}function f(a,b){return"//"+a+".disqus.com/"+b}function g(a){var b=document.createElement("script");return b.type="text/javascript",b.async=!0,b.src=a,b}function h(a,b){var c,d,e=a.getElementsByTagName("script");for(d=0;d<e.length;d+=1)if(c=e[d],~c.src.indexOf(b))return!0;return!1}function i(a,c,d){b.disqus_identifier=a,b.disqus_url=c,b.disqus_shortname=d}function j(){var c=b.DISQUSWIDGETS;c&&a.isFunction(c.getCount)&&c.getCount()}function k(a,c){b.DISQUS.reset({reload:!0,config:function(){this.page.identifier=c,this.page.url=a.absUrl()}})}function l(a,b){var d=c(),e=f(a,b);h(d,e)||d.appendChild(g(e))}var m,n="embed.js",o="count.js";this.$get=["$location",function(c){function f(e){var f=d();if(!a.isDefined(f))throw new Error("No disqus shortname defined");if(!a.isDefined(e))throw new Error("No disqus thread id defined");a.isDefined(b.DISQUS)?k(c,e):(i(e,c.absUrl(),f),l(f,n))}function g(a){i(a,c.absUrl(),m),l(d(),n),l(d(),o),j()}return{commit:f,getShortname:d,loadCount:g,setShortname:e}}]}),c.directive("disqus",["$disqus",function(b){return{restrict:"AC",replace:!0,scope:{id:"=disqus"},template:'<div id="disqus_thread"></div>',link:function(c){c.$watch("id",function(c){a.isDefined(c)&&b.commit(c)})}}}]),c.directive("disqusIdentifier",["$disqus",function(a){return{restrict:"A",link:function(b,c,d){a.loadCount(d.disqusIdentifier)}}}])}(angular,this);